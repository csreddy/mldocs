(function(n, t, i) {
    "use strict";

    function s(n, t) {
        return typeof t != "object" && (t = t()), Object.keys(t).forEach(function(i) {
            n[i] = t[i]
        }), n
    }

    function y(n) {
        return {
            from: function(t) {
                return n.prototype = Object.create(t.prototype), n.prototype.constructor = n, {
                    extend: function(i) {
                        s(n.prototype, typeof i != "object" ? i(t.prototype) : i)
                    }
                }
            }
        }
    }

    function p(n, t) {
        return t(n)
    }

    function u(n, t) {
        function cr() {
            w.on("versionchange", function() {
                w.close();
                w.on("error").fire(new g("Database version changed by other database connection."))
            })
        }

        function di(n) {
            this._cfg = {
                version: n,
                storesSource: null,
                dbschema: {},
                tables: {},
                contentUpgrade: null
            };
            this.stores({})
        }

        function lr(n, t, i, u) {
            var e, f, s, h, l, c;
            if (n === 0) Object.keys(st).forEach(function(n) {
                gi(t, n, st[n].primKey, st[n].indexes)
            }), e = w._createTransaction(yt, ui, st), e.idbtrans = t, e.idbtrans.onerror = o(i, ["populating database"]), e.on("error").subscribe(i), r.newPSD(function() {
                r.PSD.trans = e;
                try {
                    w.on("populate").fire(e)
                } catch (n) {
                    u.onerror = t.onerror = function(n) {
                        n.preventDefault()
                    };
                    try {
                        t.abort()
                    } catch (f) {}
                    t.db.close();
                    i(n)
                }
            });
            else {
                if (f = [], s = ri.filter(function(t) {
                        return t._cfg.version === n
                    })[0], !s) throw new g("Dexie specification of currently installed DB version is missing");
                st = w._dbSchema = s._cfg.dbschema;
                h = !1;
                l = ri.filter(function(t) {
                    return t._cfg.version > n
                });
                l.forEach(function(n) {
                    var e = st,
                        r = n._cfg.dbschema,
                        u;
                    fr(e, t);
                    fr(r, t);
                    st = w._dbSchema = r;
                    u = ar(e, r);
                    u.add.forEach(function(n) {
                        f.push(function(t, i) {
                            gi(t, n[0], n[1].primKey, n[1].indexes);
                            i()
                        })
                    });
                    u.change.forEach(function(n) {
                        if (n.recreate) throw new g("Not yet support for changing primary key");
                        else f.push(function(t, i) {
                            var r = t.objectStore(n.name);
                            n.add.forEach(function(n) {
                                nr(r, n)
                            });
                            n.change.forEach(function(n) {
                                r.deleteIndex(n.name);
                                nr(r, n)
                            });
                            n.del.forEach(function(n) {
                                r.deleteIndex(n)
                            });
                            i()
                        })
                    });
                    n._cfg.contentUpgrade && f.push(function(t, u) {
                        var f, e;
                        h = !0;
                        f = w._createTransaction(yt, [].slice.call(t.db.objectStoreNames, 0), r);
                        f.idbtrans = t;
                        e = 0;
                        f._promise = p(f._promise, function(n) {
                            return function(t, i, r) {
                                function f(n) {
                                    return function() {
                                        n.apply(this, arguments);
                                        --e == 0 && u()
                                    }
                                }
                                return ++e, n.call(this, t, function(n, t) {
                                    arguments[0] = f(n);
                                    arguments[1] = f(t);
                                    i.apply(this, arguments)
                                }, r)
                            }
                        });
                        t.onerror = o(i, ["running upgrader function for version", n._cfg.version]);
                        f.on("error").subscribe(i);
                        n._cfg.contentUpgrade(f);
                        e === 0 && u()
                    });
                    h && dr() || f.push(function(n, t) {
                        yr(r, n);
                        t()
                    })
                });
                c = function() {
                    try {
                        f.length ? f.shift()(t, c) : vr(st, t)
                    } catch (n) {
                        u.onerror = t.onerror = function(n) {
                            n.preventDefault()
                        };
                        try {
                            t.abort()
                        } catch (r) {}
                        t.db.close();
                        i(n)
                    }
                };
                c()
            }
        }

        function ar(n, t) {
            var f = {
                    del: [],
                    add: [],
                    change: []
                },
                r, e, o, i, c, s, u, l, h;
            for (r in n) t[r] || f.del.push(r);
            for (r in t)
                if (e = n[r], o = t[r], e)
                    if (i = {
                            name: r,
                            def: t[r],
                            recreate: !1,
                            del: [],
                            add: [],
                            change: []
                        }, e.primKey.src !== o.primKey.src) i.recreate = !0, f.change.push(i);
                    else {
                        c = e.indexes.reduce(function(n, t) {
                            return n[t.name] = t, n
                        }, {});
                        s = o.indexes.reduce(function(n, t) {
                            return n[t.name] = t, n
                        }, {});
                        for (u in c) s[u] || i.del.push(u);
                        for (u in s) l = c[u], h = s[u], l ? l.src !== h.src && i.change.push(h) : i.add.push(h);
                        (i.recreate || i.del.length > 0 || i.add.length > 0 || i.change.length > 0) && f.change.push(i)
                    } else f.add.push([r, o]);
            return f
        }

        function gi(n, t, i, r) {
            var u = n.db.createObjectStore(t, i.keyPath ? {
                keyPath: i.keyPath,
                autoIncrement: i.auto
            } : {
                autoIncrement: i.auto
            });
            return r.forEach(function(n) {
                nr(u, n)
            }), u
        }

        function vr(n, t) {
            Object.keys(n).forEach(function(i) {
                t.db.objectStoreNames.contains(i) || gi(t, i, n[i].primKey, n[i].indexes)
            })
        }

        function yr(n, t) {
            for (var u, r = 0; r < t.db.objectStoreNames.length; ++r) u = t.db.objectStoreNames[r], (n[u] === null || n[u] === i) && t.db.deleteObjectStore(u)
        }

        function nr(n, t) {
            n.createIndex(t.name, t.keyPath, {
                unique: t.unique,
                multiEntry: t.multi
            })
        }

        function pr(n, t) {
            throw new g("Table " + t[0] + " not part of transaction. Original Scope Function Source: " + u.Promise.PSD.trans.scopeFunc.toString());
        }

        function ei(n, t, i, r) {
            this.name = n;
            this.schema = i;
            this.hook = ni[n] ? ni[n].hook : v(null, {
                creating: [at, f],
                reading: [lt, nt],
                updating: [vt, f],
                deleting: [wt, f]
            });
            this._tpf = t;
            this._collClass = r || li
        }

        function tr(n, t, i, r) {
            ei.call(this, n, t, i, r || rr)
        }

        function ir(n, t, i, r) {
            function o(n, t, i, r) {
                return s._promise(n, i, r)
            }
            var s = this,
                f, u, e;
            for (this.db = w, this.mode = n, this.storeNames = t, this.idbtrans = null, this.on = v(this, ["complete", "error"], "abort"), this._reculock = 0, this._blockedFuncs = [], this._psd = null, this.active = !0, this._dbschema = i, r && (this.parent = r), this._tpf = o, this.tables = Object.create(ki), f = t.length - 1; f !== -1; --f) u = t[f], e = w._tableFactory(n, i[u], o), this.tables[u] = e, this[u] || (this[u] = e)
        }

        function ci(n, t, i) {
            this._ctx = {
                table: n,
                index: t === ":id" ? null : t,
                collClass: n._collClass,
                or: i
            }
        }

        function li(n, t) {
            var r = null,
                u = null,
                i;
            if (t) try {
                r = t()
            } catch (f) {
                u = f
            }
            i = n._ctx;
            this._ctx = {
                table: i.table,
                index: i.index,
                isPrimKey: !i.index || i.table.schema.primKey.keyPath && i.index === i.table.schema.primKey.name,
                range: r,
                op: "openCursor",
                dir: "next",
                unique: "",
                algorithm: null,
                filter: null,
                isMatch: null,
                offset: 0,
                limit: Infinity,
                error: u,
                or: i.or
            }
        }

        function rr() {
            li.apply(this, arguments)
        }

        function wr(n, t) {
            return n._cfg.version - t._cfg.version
        }

        function ur(n, t, i, u, f, e) {
            i.forEach(function(i) {
                var o = w._tableFactory(u, f[i], t);
                n.forEach(function(n) {
                    n[i] || (e ? Object.defineProperty(n, i, {
                        configurable: !0,
                        enumerable: !0,
                        get: function() {
                            var n = r.PSD && r.PSD.trans;
                            return n && n.db === w ? n.tables[i] : o
                        }
                    }) : n[i] = o)
                })
            })
        }

        function br(n) {
            n.forEach(function(n) {
                for (var t in n) n[t] instanceof ei && delete n[t]
            })
        }

        function pi(n, t, i, u, f, e) {
            var s = r.PSD;
            e = e || nt;
            n.onerror || (n.onerror = o(f));
            n.onsuccess = t ? k(function() {
                var r = n.result,
                    o;
                r ? (o = function() {
                    r.continue()
                }, t(r, function(n) {
                    o = n
                }, u, f) && i(e(r.value), r, function(n) {
                    o = n
                }), o()) : u()
            }, f, s) : k(function() {
                var t = n.result,
                    r;
                t ? (r = function() {
                    t.continue()
                }, i(e(t.value), t, function(n) {
                    r = n
                }), r()) : u()
            }, f, s)
        }

        function kr(n) {
            var t = [];
            return n.split(",").forEach(function(n) {
                n = n.trim();
                var i = n.replace("&", "").replace("++", "").replace("*", ""),
                    r = i.indexOf("[") !== 0 ? i : n.substring(n.indexOf("[") + 1, n.indexOf("]")).split("+");
                t.push(new a(i, r || null, n.indexOf("&") !== -1, n.indexOf("*") !== -1, n.indexOf("++") !== -1, Array.isArray(r), r.indexOf(".") !== -1))
            }), t
        }

        function wi(n, t) {
            return n < t ? -1 : n > t ? 1 : 0
        }

        function or(n, t) {
            return n < t ? 1 : n > t ? -1 : 0
        }

        function sr(n) {
            return function(t, i) {
                for (var r = 0, u;;) {
                    if (u = n(t[r], i[r]), u !== 0) return u;
                    if (++r, r === t.length || r === i.length) return n(t.length, i.length)
                }
            }
        }

        function bi(n, t) {
            return n ? t ? function() {
                return n.apply(this, arguments) && t.apply(this, arguments)
            } : n : t
        }

        function dr() {
            return navigator.userAgent.indexOf("Trident") >= 0 || navigator.userAgent.indexOf("MSIE") >= 0
        }

        function gr() {
            if (w.verno = et.version / 10, w._dbSchema = st = {}, ui = [].slice.call(et.objectStoreNames, 0), ui.length !== 0) {
                var n = et.transaction(ft(ui), "readonly");
                ui.forEach(function(t) {
                    for (var u, s, r = n.objectStore(t), i = r.keyPath, f = i && typeof i == "string" && i.indexOf(".") !== -1, h = new a(i, i || "", !1, !1, !!r.autoIncrement, i && typeof i != "string", f), o = [], e = 0; e < r.indexNames.length; ++e) u = r.index(r.indexNames[e]), i = u.keyPath, f = i && typeof i == "string" && i.indexOf(".") !== -1, s = new a(u.name, i, !!u.unique, !!u.multiEntry, !1, i && typeof i != "string", f), o.push(s);
                    st[t] = new ut(t, h, o, {})
                });
                ur([ni], w._transPromiseFactory, Object.keys(st), yt, st)
            }
        }

        function fr(n, t) {
            for (var i, r, u, o, s = t.db.objectStoreNames, f = 0; f < s.length; ++f)
                for (i = s[f], r = t.objectStore(i), u = 0; u < r.indexNames.length; ++u) {
                    var h = r.indexNames[u],
                        e = r.index(h).keyPath,
                        c = typeof e == "string" ? e : "[" + [].slice.call(e).join("+") + "]";
                    n[i] && (o = n[i].idxByName[c], o && (o.name = h))
                }
        }
        var hr = t && t.addons || u.addons,
            oi = u.dependencies,
            ai = oi.indexedDB,
            kt = oi.IDBKeyRange,
            nu = oi.IDBTransaction,
            tu = oi.DOMError,
            yi = oi.TypeError,
            g = oi.Error,
            st = this._dbSchema = {},
            ri = [],
            ui = [],
            ni = {},
            ki = {},
            et = null,
            si = !0,
            fi = null,
            vi = !1,
            ti = "readonly",
            yt = "readwrite",
            w = this,
            ii = [],
            hi = !1,
            er = !!ct();
        this.version = function(n) {
            if (et) throw new g("Cannot add version when database is open");
            this.verno = Math.max(this.verno, n);
            var t = ri.filter(function(t) {
                return t._cfg.version === n
            })[0];
            return t ? t : (t = new di(n), ri.push(t), ri.sort(wr), t)
        };
        s(di.prototype, {
            stores: function(n) {
                var i, t;
                return this._cfg.storesSource = this._cfg.storesSource ? s(this._cfg.storesSource, n) : n, i = {}, ri.forEach(function(n) {
                    s(i, n._cfg.storesSource)
                }), t = this._cfg.dbschema = {}, this._parseStoresSpec(i, t), st = w._dbSchema = t, br([ni, w, ki]), ur([ki], pr, Object.keys(t), yt, t), ur([ni, w, this._cfg.tables], w._transPromiseFactory, Object.keys(t), yt, t, !0), ui = Object.keys(t), this
            },
            upgrade: function(n) {
                var t = this;
                return e(function() {
                    n(w._createTransaction(yt, Object.keys(t._cfg.dbschema), t._cfg.dbschema))
                }), this._cfg.contentUpgrade = n, this
            },
            _parseStoresSpec: function(n, t) {
                Object.keys(n).forEach(function(i) {
                    if (n[i] !== null) {
                        var u = {},
                            f = kr(n[i]),
                            r = f.shift();
                        if (r.multi) throw new g("Primary key cannot be multi-valued");
                        r.keyPath && r.auto && h(u, r.keyPath, 0);
                        f.forEach(function(n) {
                            if (n.auto) throw new g("Only primary key can be marked as autoIncrement (++)");
                            if (!n.keyPath) throw new g("Index must have a name and cannot be an empty string");
                            h(u, n.keyPath, n.compound ? n.keyPath.map(function() {
                                return ""
                            }) : "")
                        });
                        t[i] = new ut(i, r, f, u)
                    }
                })
            }
        });
        this._allTables = ni;
        this._tableFactory = function(n, t, i) {
            return n === ti ? new ei(t.name, i, t, li) : new tr(t.name, i, t)
        };
        this._createTransaction = function(n, t, i, r) {
            return new ir(n, t, i, r)
        };
        this._transPromiseFactory = function(n, t, i) {
            var f, u;
            return !si || r.PSD && r.PSD.letThrough ? (u = w._createTransaction(n, t, st), u._promise(n, function(n, t) {
                u.error(function(n) {
                    w.on("error").fire(n)
                });
                i(function(t) {
                    u.complete(function() {
                        n(t)
                    })
                }, t, u)
            })) : f = new r(function(r, u) {
                ii.push({
                    resume: function() {
                        var e = w._transPromiseFactory(n, t, i);
                        f.onuncatched = e.onuncatched;
                        e.then(r, u)
                    }
                })
            })
        };
        this._whenReady = function(n) {
            return si && (!r.PSD || !r.PSD.letThrough) ? new r(function(t, i) {
                e(function() {
                    new r(function() {
                        n(t, i)
                    })
                });
                ii.push({
                    resume: function() {
                        n(t, i)
                    }
                })
            }) : new r(n)
        };
        this.verno = 0;
        this.open = function() {
            return new r(function(t, i) {
                function f(n) {
                    try {
                        u.transaction.abort()
                    } catch (t) {}
                    vi = !1;
                    fi = n;
                    si = !1;
                    i(fi);
                    ii.forEach(function(n) {
                        n.resume()
                    });
                    ii = []
                }
                if (et || vi) throw new g("Database already opened or being opened");
                var u, e = !1;
                try {
                    if (fi = null, vi = !0, ri.length === 0 && (hi = !0), !ai) throw new g("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");
                    u = hi ? ai.open(n) : ai.open(n, Math.round(w.verno * 10));
                    u.onerror = o(f, ["opening database", n]);
                    u.onblocked = function(n) {
                        w.on("blocked").fire(n)
                    };
                    u.onupgradeneeded = k(function(t) {
                        var i, r;
                        hi && !w._allowEmptyDB ? (u.onerror = function(n) {
                            n.preventDefault()
                        }, u.transaction.abort(), u.result.close(), i = ai.deleteDatabase(n), i.onsuccess = i.onerror = function() {
                            f(new g("Database '" + n + "' doesnt exist"))
                        }) : (t.oldVersion === 0 && (e = !0), u.transaction.onerror = o(f), r = t.oldVersion > Math.pow(2, 62) ? 0 : t.oldVersion, lr(r / 10, u.transaction, f, u))
                    }, f);
                    u.onsuccess = k(function() {
                        vi = !1;
                        et = u.result;
                        hi ? gr() : et.objectStoreNames.length > 0 && fr(st, et.transaction(ft(et.objectStoreNames), ti));
                        et.onversionchange = w.on("versionchange").fire;
                        er || rt(function(t) {
                            if (t.indexOf(n) === -1) return t.push(n)
                        });
                        r.newPSD(function() {
                            function i() {
                                si = !1;
                                ii.forEach(function(n) {
                                    n.resume()
                                });
                                ii = [];
                                t()
                            }
                            r.PSD.letThrough = !0;
                            try {
                                var n = w.on.ready.fire();
                                n && typeof n.then == "function" ? n.then(i, function(n) {
                                    et.close();
                                    et = null;
                                    f(n)
                                }) : b(i)
                            } catch (u) {
                                f(u)
                            }
                        })
                    }, f)
                } catch (s) {
                    f(s)
                }
            })
        };
        this.close = function() {
            et && (et.close(), et = null, si = !0, fi = null)
        };
        this.delete = function() {
            var t = arguments;
            return new r(function(i, r) {
                function u() {
                    w.close();
                    var t = ai.deleteDatabase(n);
                    t.onsuccess = function() {
                        er || rt(function(t) {
                            var i = t.indexOf(n);
                            if (i >= 0) return t.splice(i, 1)
                        });
                        i()
                    };
                    t.onerror = o(r, ["deleting", n]);
                    t.onblocked = function() {
                        w.on("blocked").fire()
                    }
                }
                if (t.length > 0) throw new g("Arguments not allowed in db.delete()");
                vi ? ii.push({
                    resume: u
                }) : u()
            })
        };
        this.backendDB = function() {
            return et
        };
        this.isOpen = function() {
            return et !== null
        };
        this.hasFailed = function() {
            return fi !== null
        };
        this.dynamicallyOpened = function() {
            return hi
        };
        this.name = n;
        Object.defineProperty(this, "tables", {
            get: function() {
                return Object.keys(ni).map(function(n) {
                    return ni[n]
                })
            }
        });
        this.on = v(this, "error", "populate", "blocked", {
            ready: [bt, f],
            versionchange: [pt, f]
        });
        this.on.ready.subscribe = p(this.on.ready.subscribe, function(n) {
            return function(t, i) {
                function r() {
                    return i || w.on.ready.unsubscribe(r), t.apply(this, arguments)
                }
                n.call(this, r);
                w.isOpen() && (si ? ii.push({
                    resume: r
                }) : r())
            }
        });
        e(function() {
            w.on("populate").fire(w._createTransaction(yt, ui, st));
            w.on("error").fire(new g)
        });
        this.transaction = function(n, t, i) {
            function s(t, e) {
                var s = null,
                    c, a, h;
                try {
                    if (f) throw f;
                    s = w._createTransaction(n, o, st, u);
                    c = o.map(function(n) {
                        return s.tables[n]
                    });
                    c.push(s);
                    h = 0;
                    r.newPSD(function() {
                        r.PSD.trans = s;
                        s.scopeFunc = i;
                        u && (s.idbtrans = u.idbtrans, s._promise = p(s._promise, function(n) {
                            return function(t, i, u) {
                                function f(n) {
                                    return function(t) {
                                        var i;
                                        return r._rootExec(function() {
                                            i = n(t);
                                            r._tickFinalize(function() {
                                                --h == 0 && s.active && (s.active = !1, s.on.complete.fire())
                                            })
                                        }), i
                                    }
                                }
                                return ++h, n.call(this, t, function(n, t, r) {
                                    return i(f(n), f(t), r)
                                }, u)
                            }
                        }));
                        s.complete(function() {
                            t(a)
                        });
                        s.error(function(n) {
                            s.idbtrans && (s.idbtrans.onerror = ht);
                            try {
                                s.abort()
                            } catch (i) {}
                            u && (u.active = !1, u.on.error.fire(n));
                            var t = e(n);
                            u || t || w.on.error.fire(n)
                        });
                        r._rootExec(function() {
                            a = i.apply(s, c)
                        })
                    });
                    (!s.idbtrans || u && h === 0) && s._nop()
                } catch (l) {
                    s && s.idbtrans && (s.idbtrans.onerror = ht);
                    s && s.abort();
                    u && u.on.error.fire(l);
                    b(function() {
                        e(l) || w.on("error").fire(l)
                    })
                }
            }
            var u, e;
            t = [].slice.call(arguments, 1, arguments.length - 1);
            i = arguments[arguments.length - 1];
            u = r.PSD && r.PSD.trans;
            u && u.db === w && n.indexOf("!") === -1 || (u = null);
            e = n.indexOf("?") !== -1;
            n = n.replace("!", "").replace("?", "");
            var h = Array.isArray(t[0]) ? t.reduce(function(n, t) {
                    return n.concat(t)
                }) : t,
                f = null,
                o = h.map(function(n) {
                    return typeof n == "string" ? n : (n instanceof ei || (f = f || new yi("Invalid type. Arguments following mode must be instances of Table or String")), n.name)
                });
            return n == "r" || n == ti ? n = ti : n == "rw" || n == yt ? n = yt : f = new g("Invalid transaction mode: " + n), u && (f || (u && u.mode === ti && n === yt && (e ? u = null : f = f || new g("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")), u && o.forEach(function(n) {
                u.tables.hasOwnProperty(n) || (e ? u = null : f = f || new g("Table " + n + " not included in parent transaction. Parent Transaction function: " + u.scopeFunc.toString()))
            }))), u ? u._promise(n, s, "lock") : w._whenReady(s)
        };
        this.table = function(n) {
            if (!hi && !ni.hasOwnProperty(n)) throw new g("Table does not exist");
            return ni[n]
        };
        s(ei.prototype, function() {
            function n() {
                throw new g("Current Transaction is READONLY");
            }
            return {
                _trans: function(n, t, i) {
                    return this._tpf(n, [this.name], t, i)
                },
                _idbstore: function(n, t, i) {
                    var r = this;
                    return this._tpf(n, [this.name], function(n, i, u) {
                        t(n, i, u.idbtrans.objectStore(r.name), u)
                    }, i)
                },
                get: function(n, t) {
                    var i = this;
                    return e(function() {
                        t(i.schema.instanceTemplate)
                    }), this._idbstore(ti, function(t, r, u) {
                        var f = u.get(n);
                        f.onerror = o(r, ["getting", n, "from", i.name]);
                        f.onsuccess = function() {
                            t(i.hook.reading.fire(f.result))
                        }
                    }).then(t)
                },
                where: function(n) {
                    return new ci(this, n)
                },
                count: function(n) {
                    return this.toCollection().count(n)
                },
                offset: function(n) {
                    return this.toCollection().offset(n)
                },
                limit: function(n) {
                    return this.toCollection().limit(n)
                },
                reverse: function() {
                    return this.toCollection().reverse()
                },
                filter: function(n) {
                    return this.toCollection().and(n)
                },
                each: function(n) {
                    var t = this;
                    return e(function() {
                        n(t.schema.instanceTemplate)
                    }), this._idbstore(ti, function(i, r, u) {
                        var f = u.openCursor();
                        f.onerror = o(r, ["calling", "Table.each()", "on", t.name]);
                        pi(f, null, n, i, r, t.hook.reading.fire)
                    })
                },
                toArray: function(n) {
                    var t = this;
                    return e(function() {
                        n([t.schema.instanceTemplate])
                    }), this._idbstore(ti, function(n, i, r) {
                        var u = [],
                            f = r.openCursor();
                        f.onerror = o(i, ["calling", "Table.toArray()", "on", t.name]);
                        pi(f, null, function(n) {
                            u.push(n)
                        }, function() {
                            n(u)
                        }, i, t.hook.reading.fire)
                    }).then(n)
                },
                orderBy: function(n) {
                    return new this._collClass(new ci(this, n))
                },
                toCollection: function() {
                    return new this._collClass(new ci(this))
                },
                mapToClass: function(n, t) {
                    var i, r;
                    return this.schema.mappedClass = n, i = Object.create(n.prototype), this.schema.primKey.keyPath && (h(i, this.schema.primKey.keyPath, this.schema.primKey.auto ? 0 : ""), ot(n.prototype, this.schema.primKey.keyPath)), t && it(i, t), this.schema.instanceTemplate = i, r = Object.setPrototypeOf ? function(t) {
                        return t ? (Object.setPrototypeOf(t, n.prototype), t) : t
                    } : function(t) {
                        var r, i;
                        if (!t) return t;
                        r = Object.create(n.prototype);
                        for (i in t) t.hasOwnProperty(i) && (r[i] = t[i]);
                        return r
                    }, this.schema.readHook && this.hook.reading.unsubscribe(this.schema.readHook), this.schema.readHook = r, this.hook("reading", r), n
                },
                defineClass: function(n) {
                    return this.mapToClass(u.defineClass(n), n)
                },
                add: n,
                put: n,
                "delete": n,
                clear: n,
                update: n
            }
        });
        y(tr).from(ei).extend(function() {
            return {
                add: function(n, t) {
                    var u = this,
                        r = this.hook.creating.fire;
                    return this._idbstore(yt, function(e, s, l, a) {
                        var v = {},
                            w, y, p;
                        r !== f && (w = t || (l.keyPath ? c(n, l.keyPath) : i), y = r.call(v, w, n, a), w === i && y !== i && (l.keyPath ? h(n, l.keyPath, y) : t = y));
                        p = t ? l.add(n, t) : l.add(n);
                        p.onerror = o(function(n) {
                            if (v.onerror) v.onerror(n);
                            return s(n)
                        }, ["adding", n, "into", u.name]);
                        p.onsuccess = function(t) {
                            var i = l.keyPath;
                            if (i && h(n, i, t.target.result), v.onsuccess) v.onsuccess(t.target.result);
                            e(p.result)
                        }
                    })
                },
                put: function(n, t) {
                    var r = this,
                        u = this.hook.creating.fire,
                        e = this.hook.updating.fire;
                    return u !== f || e !== f ? this._trans(yt, function(u, f, e) {
                        var o = t || r.schema.primKey.keyPath && c(n, r.schema.primKey.keyPath);
                        o === i ? e.tables[r.name].add(n).then(u, f) : (e._lock(), n = l(n), e.tables[r.name].where(":id").equals(o).modify(function() {
                            this.value = n
                        }).then(function(i) {
                            return i === 0 ? e.tables[r.name].add(n, t) : o
                        }).finally(function() {
                            e._unlock()
                        }).then(u, f))
                    }) : this._idbstore(yt, function(i, u, f) {
                        var e = t ? f.put(n, t) : f.put(n);
                        e.onerror = o(u, ["putting", n, "into", r.name]);
                        e.onsuccess = function(t) {
                            var r = f.keyPath;
                            r && h(n, r, t.target.result);
                            i(e.result)
                        }
                    })
                },
                "delete": function(n) {
                    return this.hook.deleting.subscribers.length ? this.where(":id").equals(n).delete() : this._idbstore(yt, function(t, i, r) {
                        var u = r.delete(n);
                        u.onerror = o(i, ["deleting", n, "from", r.name]);
                        u.onsuccess = function() {
                            t(u.result)
                        }
                    })
                },
                clear: function() {
                    return this.hook.deleting.subscribers.length ? this.toCollection().delete() : this._idbstore(yt, function(n, t, i) {
                        var r = i.clear();
                        r.onerror = o(t, ["clearing", i.name]);
                        r.onsuccess = function() {
                            n(r.result)
                        }
                    })
                },
                update: function(n, t) {
                    if (typeof t != "object" || Array.isArray(t)) throw new g("db.update(keyOrObject, modifications). modifications must be an object.");
                    if (typeof n != "object" || Array.isArray(n)) return this.where(":id").equals(n).modify(t);
                    Object.keys(t).forEach(function(i) {
                        h(n, i, t[i])
                    });
                    var u = c(n, this.schema.primKey.keyPath);
                    return u === i && r.reject(new g("Object does not contain its primary key")), this.where(":id").equals(u).modify(t)
                }
            }
        });
        s(ir.prototype, {
            _lock: function() {
                return ++this._reculock, this._reculock === 1 && r.PSD && (r.PSD.lockOwnerFor = this), this
            },
            _unlock: function() {
                if (--this._reculock == 0)
                    for (r.PSD && (r.PSD.lockOwnerFor = null); this._blockedFuncs.length > 0 && !this._locked();) {
                        var n = this._blockedFuncs.shift();
                        try {
                            n()
                        } catch (t) {}
                    }
                return this
            },
            _locked: function() {
                return this._reculock && (!r.PSD || r.PSD.lockOwnerFor !== this)
            },
            _nop: function(n) {
                this.tables[this.storeNames[0]].get(0).then(n)
            },
            _promise: function(n, t, i) {
                var f = this;
                return r.newPSD(function() {
                    var e;
                    return f._locked() ? e = new r(function(r, u) {
                        f._blockedFuncs.push(function() {
                            f._promise(n, t, i).then(r, u)
                        })
                    }) : (e = f.active ? new r(function(r, e) {
                        if (!f.idbtrans && n) {
                            if (!et) throw fi ? new g("Database not open. Following error in populate, ready or upgrade function made Dexie.open() fail: " + fi) : new g("Database not open");
                            var o = f.idbtrans = et.transaction(ft(f.storeNames), f.mode);
                            o.onerror = function(n) {
                                f.on("error").fire(n && n.target.error);
                                n.preventDefault();
                                f.abort()
                            };
                            o.onabort = function(n) {
                                f.active = !1;
                                f.on("abort").fire(n)
                            };
                            o.oncomplete = function(n) {
                                f.active = !1;
                                f.on("complete").fire(n)
                            }
                        }
                        i && f._lock();
                        try {
                            t(r, e, f)
                        } catch (s) {
                            u.ignoreTransaction(function() {
                                f.on("error").fire(s)
                            });
                            f.abort();
                            e(s)
                        }
                    }) : r.reject(gt(new g("Transaction is inactive. Original Scope Function Source: " + f.scopeFunc.toString()))), f.active && i && e.finally(function() {
                        f._unlock()
                    })), e.onuncatched = function(n) {
                        u.ignoreTransaction(function() {
                            f.on("error").fire(n)
                        });
                        f.abort()
                    }, e
                })
            },
            complete: function(n) {
                return this.on("complete", n)
            },
            error: function(n) {
                return this.on("error", n)
            },
            abort: function() {
                if (this.idbtrans && this.active) try {
                    this.active = !1;
                    this.idbtrans.abort();
                    this.on.error.fire(new g("Transaction Aborted"))
                } catch (n) {}
            },
            table: function(n) {
                if (!this.tables.hasOwnProperty(n)) throw new g("Table " + n + " not in transaction");
                return this.tables[n]
            }
        });
        s(ci.prototype, function() {
            function n(n, t) {
                try {
                    throw t;
                } catch (i) {
                    n._ctx.error = i
                }
                return n
            }

            function i(n) {
                return Array.prototype.slice.call(n.length === 1 && Array.isArray(n[0]) ? n[0] : n)
            }

            function r(n) {
                return n === "next" ? function(n) {
                    return n.toUpperCase()
                } : function(n) {
                    return n.toLowerCase()
                }
            }

            function u(n) {
                return n === "next" ? function(n) {
                    return n.toLowerCase()
                } : function(n) {
                    return n.toUpperCase()
                }
            }

            function f(n, t, i, r, u, f) {
                for (var h, s = Math.min(n.length, r.length), o = -1, e = 0; e < s; ++e) {
                    if (h = t[e], h !== r[e]) return u(n[e], i[e]) < 0 ? n.substr(0, e) + i[e] + i.substr(e + 1) : u(n[e], r[e]) < 0 ? n.substr(0, e) + r[e] + i.substr(e + 1) : o >= 0 ? n.substr(0, o) + t[o] + i.substr(o + 1) : null;
                    u(n[e], h) < 0 && (o = e)
                }
                return s < r.length && f === "next" ? n + i.substr(n.length) : s < n.length && f === "prev" ? n.substr(0, i.length) : o < 0 ? null : n.substr(0, o) + r[o] + i.substr(o + 1)
            }

            function t(n, t, i) {
                function a(n) {
                    s = r(n);
                    e = u(n);
                    h = n === "next" ? wi : or;
                    c = s(i);
                    o = e(i);
                    l = n
                }
                var s, e, h, c, o, l;
                a("next");
                n._ondirectionchange = function(n) {
                    a(n)
                };
                n._addAlgorithm(function(n, i, r) {
                    var u = n.key,
                        s, a;
                    return typeof u != "string" ? !1 : (s = e(u), t(s, o) ? (i(function() {
                        n.continue()
                    }), !0) : (a = f(u, s, c, o, h, l), a ? i(function() {
                        n.continue(a)
                    }) : i(r), !1))
                })
            }
            return {
                between: function(n, t, i, r) {
                    return (i = i !== !1, r = r === !0, n > t || n === t && (i || r) && !(i && r)) ? new this._ctx.collClass(this, function() {
                        return kt.only(n)
                    }).limit(0) : new this._ctx.collClass(this, function() {
                        return kt.bound(n, t, !i, !r)
                    })
                },
                equals: function(n) {
                    return new this._ctx.collClass(this, function() {
                        return kt.only(n)
                    })
                },
                above: function(n) {
                    return new this._ctx.collClass(this, function() {
                        return kt.lowerBound(n, !0)
                    })
                },
                aboveOrEqual: function(n) {
                    return new this._ctx.collClass(this, function() {
                        return kt.lowerBound(n)
                    })
                },
                below: function(n) {
                    return new this._ctx.collClass(this, function() {
                        return kt.upperBound(n, !0)
                    })
                },
                belowOrEqual: function(n) {
                    return new this._ctx.collClass(this, function() {
                        return kt.upperBound(n)
                    })
                },
                startsWith: function(t) {
                    return typeof t != "string" ? n(new this._ctx.collClass(this), new yi("String expected")) : this.between(t, t + String.fromCharCode(65535), !0, !0)
                },
                startsWithIgnoreCase: function(i) {
                    if (typeof i != "string") return n(new this._ctx.collClass(this), new yi("String expected"));
                    if (i === "") return this.startsWith(i);
                    var r = new this._ctx.collClass(this, function() {
                        return kt.bound(i.toUpperCase(), i.toLowerCase() + String.fromCharCode(65535))
                    });
                    return t(r, function(n, t) {
                        return n.indexOf(t) === 0
                    }, i), r._ondirectionchange = function() {
                        n(r, new g("reverse() not supported with WhereClause.startsWithIgnoreCase()"))
                    }, r
                },
                equalsIgnoreCase: function(i) {
                    if (typeof i != "string") return n(new this._ctx.collClass(this), new yi("String expected"));
                    var r = new this._ctx.collClass(this, function() {
                        return kt.bound(i.toUpperCase(), i.toLowerCase())
                    });
                    return t(r, function(n, t) {
                        return n === t
                    }, i), r
                },
                anyOf: function() {
                    var f = this._ctx,
                        e = f.table.schema,
                        o = f.index ? e.idxByName[f.index] : e.primKey,
                        s = o && o.compound,
                        n = i(arguments),
                        t = s ? sr(wi) : wi,
                        u, r;
                    return (n.sort(t), n.length === 0) ? new this._ctx.collClass(this, function() {
                        return kt.only("")
                    }).limit(0) : (u = new this._ctx.collClass(this, function() {
                        return kt.bound(n[0], n[n.length - 1])
                    }), u._ondirectionchange = function(i) {
                        t = i === "next" ? wi : or;
                        s && (t = sr(t));
                        n.sort(t)
                    }, r = 0, u._addAlgorithm(function(i, u, f) {
                        for (var e = i.key; t(e, n[r]) > 0;)
                            if (++r, r === n.length) return u(f), !1;
                        return t(e, n[r]) === 0 ? (u(function() {
                            i.continue()
                        }), !0) : (u(function() {
                            i.continue(n[r])
                        }), !1)
                    }), u)
                }
            }
        });
        s(li.prototype, function() {
            function t(n, t) {
                n.filter = bi(n.filter, t)
            }

            function f(n, t) {
                n.isMatch = bi(n.isMatch, t)
            }

            function r(n, t) {
                if (n.isPrimKey) return t;
                var i = n.table.schema.idxByName[n.index];
                if (!i) throw new g("KeyPath " + n.index + " on object store " + t.name + " is not indexed");
                return n.isPrimKey ? t : t.index(i.name)
            }

            function u(n, t) {
                return r(n, t)[n.op](n.range || null, n.dir + n.unique)
            }

            function i(n, t, i, r, f) {
                n.or ? function() {
                    function e() {
                        ++c == 2 && i()
                    }

                    function h(n, i, u) {
                        if (!o || o(i, u, e, r)) {
                            var f = i.primaryKey.toString();
                            s.hasOwnProperty(f) || (s[f] = !0, t(n, i, u))
                        }
                    }
                    var o = n.filter,
                        s = {},
                        l = n.table.schema.primKey.keyPath,
                        c = 0;
                    n.or._iterate(h, e, r, f);
                    pi(u(n, f), n.algorithm, h, e, r, n.table.hook.reading.fire)
                }() : pi(u(n, f), bi(n.algorithm, n.filter), t, i, r, n.table.hook.reading.fire)
            }

            function n(n) {
                return n.table.schema.instanceTemplate
            }
            return {
                _read: function(n, t) {
                    var i = this._ctx;
                    return i.error ? i.table._trans(null, function(n, t) {
                        t(i.error)
                    }) : i.table._idbstore(ti, n).then(t)
                },
                _write: function(n) {
                    var t = this._ctx;
                    return t.error ? t.table._trans(null, function(n, i) {
                        i(t.error)
                    }) : t.table._idbstore(yt, n, "locked")
                },
                _addAlgorithm: function(n) {
                    var t = this._ctx;
                    t.algorithm = bi(t.algorithm, n)
                },
                _iterate: function(n, t, r, u) {
                    return i(this._ctx, n, t, r, u)
                },
                each: function(t) {
                    var r = this._ctx;
                    return e(function() {
                        t(n(r))
                    }), this._read(function(n, u, f) {
                        i(r, t, n, u, f)
                    })
                },
                count: function(n) {
                    var f, t, u;
                    return e(function() {
                        n(0)
                    }), f = this, t = this._ctx, t.filter || t.algorithm || t.or ? (u = 0, this._read(function(n, r, f) {
                        i(t, function() {
                            return ++u, !1
                        }, function() {
                            n(u)
                        }, r, f)
                    }, n)) : this._read(function(n, i, u) {
                        var e = r(t, u),
                            s = t.range ? e.count(t.range) : e.count();
                        s.onerror = o(i, ["calling", "count()", "on", f.name]);
                        s.onsuccess = function(i) {
                            n(Math.min(i.target.result, Math.max(0, t.limit - t.offset)))
                        }
                    }, n)
                },
                sortBy: function(t, i) {
                    function u(n, t) {
                        return t ? u(n[r[t]], t - 1) : n[h]
                    }

                    function c(n, t) {
                        var i = u(n, o),
                            r = u(t, o);
                        return i < r ? -f : i > r ? f : 0
                    }
                    var s = this._ctx,
                        f;
                    e(function() {
                        i([n(s)])
                    });
                    var r = t.split(".").reverse(),
                        h = r[0],
                        o = r.length - 1;
                    return f = this._ctx.dir === "next" ? 1 : -1, this.toArray(function(n) {
                        return n.sort(c)
                    }).then(i)
                },
                toArray: function(t) {
                    var r = this._ctx;
                    return e(function() {
                        t([n(r)])
                    }), this._read(function(n, t, u) {
                        var f = [];
                        i(r, function(n) {
                            f.push(n)
                        }, function() {
                            n(f)
                        }, t, u)
                    }, t)
                },
                offset: function(n) {
                    var i = this._ctx;
                    return n <= 0 ? this : (i.offset += n, i.or || i.algorithm || i.filter ? t(i, function() {
                        return --n < 0
                    }) : t(i, function(t, i) {
                        return n === 0 ? !0 : n === 1 ? (--n, !1) : (i(function() {
                            t.advance(n);
                            n = 0
                        }), !1)
                    }), this)
                },
                limit: function(n) {
                    return this._ctx.limit = Math.min(this._ctx.limit, n), t(this._ctx, function(t, i, r) {
                        return --n <= 0 && i(r), n >= 0
                    }), this
                },
                until: function(i, r) {
                    var u = this._ctx;
                    return e(function() {
                        i(n(u))
                    }), t(this._ctx, function(n, t, u) {
                        return i(n.value) ? (t(u), r) : !0
                    }), this
                },
                first: function(t) {
                    var i = this;
                    return e(function() {
                        t(n(i._ctx))
                    }), this.limit(1).toArray(function(n) {
                        return n[0]
                    }).then(t)
                },
                last: function(n) {
                    return this.reverse().first(n)
                },
                and: function(i) {
                    var r = this;
                    return e(function() {
                        i(n(r._ctx))
                    }), t(this._ctx, function(n) {
                        return i(n.value)
                    }), f(this._ctx, i), this
                },
                or: function(n) {
                    return new ci(this._ctx.table, n, this)
                },
                reverse: function() {
                    return this._ctx.dir = this._ctx.dir === "prev" ? "next" : "prev", this._ondirectionchange && this._ondirectionchange(this._ctx.dir), this
                },
                desc: function() {
                    return this.reverse()
                },
                eachKey: function(t) {
                    var i = this,
                        r = this._ctx;
                    return e(function() {
                        t(n(i._ctx)[i._ctx.index])
                    }), r.isPrimKey || (r.op = "openKeyCursor"), this.each(function(n, i) {
                        t(i.key, i)
                    })
                },
                eachUniqueKey: function(n) {
                    return this._ctx.unique = "unique", this.eachKey(n)
                },
                keys: function(t) {
                    var u, i, r;
                    return e(function() {
                        t([n(i)[u._ctx.index]])
                    }), u = this, i = this._ctx, i.isPrimKey || (i.op = "openKeyCursor"), r = [], this.each(function(n, t) {
                        r.push(t.key)
                    }).then(function() {
                        return r
                    }).then(t)
                },
                uniqueKeys: function(n) {
                    return this._ctx.unique = "unique", this.keys(n)
                },
                firstKey: function(n) {
                    var t = this;
                    return this.limit(1).keys(function(n) {
                        return n[0]
                    }).then(n)
                },
                lastKey: function(n) {
                    return this.reverse().firstKey(n)
                },
                distinct: function() {
                    var n = {};
                    return t(this._ctx, function(t) {
                        var i = t.primaryKey.toString(),
                            r = n.hasOwnProperty(i);
                        return n[i] = !0, !r
                    }), this
                }
            }
        });
        y(rr).from(li).extend({
            modify: function(n) {
                var a = this,
                    t = this._ctx,
                    r = t.table.hook,
                    i = r.updating.fire,
                    u = r.deleting.fire;
                return e(function() {
                    typeof n == "function" && n.call({
                        value: t.table.schema.instanceTemplate
                    }, t.table.schema.instanceTemplate)
                }), this._write(function(r, e, v, y) {
                    function st(n, i) {
                        var r, u, f;
                        if (et = i.primaryKey, r = {
                                primKey: i.primaryKey,
                                value: n
                            }, w.call(r, n) !== !1) u = !r.hasOwnProperty("value"), f = u ? i.delete() : i.update(r.value), ++ut, f.onerror = o(function(n) {
                            if (p.push(n), nt.push(r.primKey), r.onerror) r.onerror(n);
                            return it(), !0
                        }, u ? ["deleting", n, "from", t.table.name] : ["modifying", n, "on", t.table.name]), f.onsuccess = function() {
                            if (r.onsuccess) r.onsuccess(r.value);
                            ++b;
                            it()
                        };
                        else if (r.onsuccess) r.onsuccess(r.value)
                    }

                    function ot(n) {
                        return n && (p.push(n), nt.push(et)), e(new d("Error modifying one or more objects", p, b, nt))
                    }

                    function it() {
                        ft && b + p.length === ut && (p.length > 0 ? ot() : r(b))
                    }
                    var w, k, rt, g;
                    typeof n == "function" ? w = i === f && u === f ? n : function(t) {
                        var f = l(t),
                            e, r;
                        if (n.call(this, t) === !1) return !1;
                        this.hasOwnProperty("value") ? (e = dt(f, this.value), r = i.call(this, e, this.primKey, f, y), r && (t = this.value, Object.keys(r).forEach(function(n) {
                            h(t, n, r[n])
                        }))) : u.call(this, this.primKey, t, y)
                    } : i === f ? (k = Object.keys(n), rt = k.length, w = function(t) {
                        for (var i, u, f = !1, r = 0; r < rt; ++r) i = k[r], u = n[i], c(t, i) !== u && (h(t, i, u), f = !0);
                        return f
                    }) : (g = n, n = tt(g), w = function(t) {
                        var u = !1,
                            r = i.call(this, n, this.primKey, l(t), y);
                        return r && s(n, r), Object.keys(n).forEach(function(i) {
                            var r = n[i];
                            c(t, i) !== r && (h(t, i, r), u = !0)
                        }), r && (n = tt(g)), u
                    });
                    var ut = 0,
                        b = 0,
                        ft = !1,
                        p = [],
                        nt = [],
                        et = null;
                    a._iterate(st, function() {
                        ft = !0;
                        it()
                    }, ot, v)
                })
            },
            "delete": function() {
                return this.modify(function() {
                    delete this.value
                })
            }
        });
        s(this, {
            Collection: li,
            Table: ei,
            Transaction: ir,
            Version: di,
            WhereClause: ci,
            WriteableCollection: rr,
            WriteableTable: tr
        });
        cr();
        hr.forEach(function(n) {
            n(w)
        })
    }

    function f() {}

    function nt(n) {
        return n
    }

    function lt(n, t) {
        return n === nt ? t : function(i) {
            return t(n(i))
        }
    }

    function w(n, t) {
        return function() {
            n.apply(this, arguments);
            t.apply(this, arguments)
        }
    }

    function at(n, t) {
        return n === f ? t : function() {
            var f = n.apply(this, arguments),
                r, u, e;
            return f !== i && (arguments[0] = f), r = this.onsuccess, u = this.onerror, delete this.onsuccess, delete this.onerror, e = t.apply(this, arguments), r && (this.onsuccess = this.onsuccess ? w(r, this.onsuccess) : r), u && (this.onerror = this.onerror ? w(u, this.onerror) : u), e !== i ? e : f
        }
    }

    function vt(n, t) {
        return n === f ? t : function() {
            var r = n.apply(this, arguments),
                f, e, u;
            return r !== i && s(arguments[0], r), f = this.onsuccess, e = this.onerror, delete this.onsuccess, delete this.onerror, u = t.apply(this, arguments), f && (this.onsuccess = this.onsuccess ? w(f, this.onsuccess) : f), e && (this.onerror = this.onerror ? w(e, this.onerror) : e), r === i ? u === i ? i : u : u === i ? r : s(r, u)
        }
    }

    function yt(n, t) {
        return n === f ? t : function() {
            return n.apply(this, arguments) === !1 ? !1 : t.apply(this, arguments)
        }
    }

    function pt(n, t) {
        return n === f ? t : function() {
            return t.apply(this, arguments) === !1 ? !1 : n.apply(this, arguments)
        }
    }

    function wt(n, t) {
        return n === f ? t : function() {
            n.apply(this, arguments);
            t.apply(this, arguments)
        }
    }

    function bt(n, t) {
        return n === f ? t : function() {
            var i = n.apply(this, arguments),
                r, u;
            return i && typeof i.then == "function" ? (r = this, u = arguments, i.then(function() {
                return t.apply(r, u)
            })) : t.apply(this, arguments)
        }
    }

    function v(t) {
        function i(n, t, i) {
            if (Array.isArray(n)) return c(n);
            if (typeof n == "object") return h(n);
            t || (t = yt);
            i || (i = f);
            var r = {
                subscribers: [],
                fire: i,
                subscribe: function(n) {
                    r.subscribers.push(n);
                    r.fire = t(r.fire, n)
                },
                unsubscribe: function(n) {
                    r.subscribers = r.subscribers.filter(function(t) {
                        return t !== n
                    });
                    r.fire = r.subscribers.reduce(t, i)
                }
            };
            return u[n] = e[n] = r, r
        }

        function h(t) {
            Object.keys(t).forEach(function(r) {
                var f = t[r],
                    u;
                if (Array.isArray(f)) i(r, t[r][0], t[r][1]);
                else if (f === "asap") u = i(r, null, function() {
                    var t = arguments;
                    u.subscribers.forEach(function(i) {
                        b(function() {
                            i.apply(n, t)
                        })
                    })
                }), u.subscribe = function(n) {
                    u.subscribers.indexOf(n) === -1 && u.subscribers.push(n)
                }, u.unsubscribe = function(n) {
                    var t = u.subscribers.indexOf(n);
                    t !== -1 && u.subscribers.splice(t, 1)
                };
                else throw new Error("Invalid event config");
            })
        }

        function c(n) {
            function r() {
                if (t) return !1;
                t = !0
            }
            var t = !1;
            n.forEach(function(n) {
                i(n).subscribe(r)
            })
        }
        var o = arguments,
            u = {},
            e = function(n, i) {
                if (i) {
                    var f = [].slice.call(arguments, 1),
                        r = u[n];
                    return r.subscribe.apply(r, f), t
                }
                if (typeof n == "string") return u[n]
            },
            r, s;
        for (e.addEventType = i, r = 1, s = o.length; r < s; ++r) i(o[r]);
        return e
    }

    function kt(n) {
        if (!n) throw new Error("Assertion failed");
    }

    function b(t) {
        n.setImmediate ? setImmediate(t) : setTimeout(t, 0)
    }

    function et(n) {
        var t = setTimeout(n, 1e3);
        clearTimeout(t)
    }

    function k(n, t, i) {
        return function() {
            var u = r.PSD;
            r.PSD = i;
            try {
                n.apply(this, arguments)
            } catch (f) {
                t(f)
            } finally {
                r.PSD = u
            }
        }
    }

    function c(n, t) {
        var f, r, o, s, u, e;
        if (n.hasOwnProperty(t)) return n[t];
        if (!t) return n;
        if (typeof t != "string") {
            for (f = [], r = 0, o = t.length; r < o; ++r) s = c(n, t[r]), f.push(s);
            return f
        }
        return (u = t.indexOf("."), u !== -1) ? (e = n[t.substr(0, u)], e === i ? i : c(e, t.substr(u + 1))) : i
    }

    function h(n, t, r) {
        var u, c, e, f, s, o;
        if (n && t !== i)
            if (typeof t != "string" && "length" in t)
                for (kt(typeof r != "string" && "length" in r), u = 0, c = t.length; u < c; ++u) h(n, t[u], r[u]);
            else e = t.indexOf("."), e !== -1 ? (f = t.substr(0, e), s = t.substr(e + 1), s === "" ? r === i ? delete n[f] : n[f] = r : (o = n[f], o || (o = n[f] = {}), h(o, s, r))) : r === i ? delete n[t] : n[t] = r
    }

    function ot(n, t) {
        h(n, t, i)
    }

    function tt(n) {
        var i = {};
        for (var t in n) n.hasOwnProperty(t) && (i[t] = n[t]);
        return i
    }

    function l(n) {
        var t, i, u, r;
        if (!n || typeof n != "object") return n;
        if (Array.isArray(n))
            for (t = [], i = 0, u = n.length; i < u; ++i) t.push(l(n[i]));
        else if (n instanceof Date) t = new Date, t.setTime(n.getTime());
        else {
            t = n.constructor ? Object.create(n.constructor.prototype) : {};
            for (r in n) n.hasOwnProperty(r) && (t[r] = l(n[r]))
        }
        return t
    }

    function dt(n, t) {
        var u = {};
        for (var r in n) n.hasOwnProperty(r) && (t.hasOwnProperty(r) ? n[r] !== t[r] && JSON.stringify(n[r]) != JSON.stringify(t[r]) && (u[r] = t[r]) : u[r] = i);
        for (r in t) t.hasOwnProperty(r) && !n.hasOwnProperty(r) && (u[r] = t[r]);
        return u
    }

    function st(n) {
        if (typeof n == "function") return new n;
        if (Array.isArray(n)) return [st(n[0])];
        if (n && typeof n == "object") {
            var t = {};
            return it(t, n), t
        }
        return n
    }

    function it(n, t) {
        Object.keys(t).forEach(function(i) {
            var r = st(t[i]);
            n[i] = r
        })
    }

    function o(n, t) {
        return function(i) {
            var r = i && i.target.error || new Error,
                u;
            return t && (u = " occurred when " + t.map(function(n) {
                switch (typeof n) {
                    case "function":
                        return n();
                    case "string":
                        return n;
                    default:
                        return JSON.stringify(n)
                }
            }).join(" "), r.name ? r.toString = function() {
                return r.name + u + (r.message ? ". " + r.message : "")
            } : r = r + u), n(r), i && (i.stopPropagation && i.stopPropagation(), i.preventDefault && i.preventDefault()), !1
        }
    }

    function gt(n) {
        try {
            throw n;
        } catch (t) {
            return t
        }
    }

    function ht(n) {
        n.preventDefault()
    }

    function rt(n) {
        var t, i = u.dependencies.localStorage;
        if (!i) return n([]);
        try {
            t = JSON.parse(i.getItem("Dexie.DatabaseNames") || "[]")
        } catch (r) {
            t = []
        }
        n(t) && i.setItem("Dexie.DatabaseNames", JSON.stringify(t))
    }

    function a(n, t, i, r, u, f, e) {
        this.name = n;
        this.keyPath = t;
        this.unique = i;
        this.multi = r;
        this.auto = u;
        this.compound = f;
        this.dotted = e;
        var o = typeof t == "string" ? t : t && "[" + [].join.call(t, "+") + "]";
        this.src = (i ? "&" : "") + (r ? "*" : "") + (u ? "++" : "") + o
    }

    function ut(n, t, i, r) {
        this.name = n;
        this.primKey = t || new a;
        this.indexes = i || [new a];
        this.instanceTemplate = r;
        this.mappedClass = null;
        this.idxByName = i.reduce(function(n, t) {
            return n[t.name] = t, n
        }, {})
    }

    function d(n, t, i, r) {
        this.name = "ModifyError";
        this.failures = t;
        this.failedKeys = r;
        this.successCount = i;
        this.message = t.join("\n")
    }

    function ft(n) {
        return n.length === 1 ? n[0] : n
    }

    function ct() {
        var n = u.dependencies.indexedDB,
            t = n && (n.getDatabaseNames || n.webkitGetDatabaseNames);
        return t && t.bind(n)
    }
    var r = function() {
            function y(n) {
                u.push([n, a.call(arguments, 1)])
            }

            function p() {
                var r = u,
                    t, f, i;
                for (u = [], t = 0, f = r.length; t < f; ++t) i = r[t], i[0].apply(n, i[1])
            }

            function t(n) {
                if (typeof this != "object") throw new TypeError("Promises must be constructed via new");
                if (typeof n != "function") throw new TypeError("not a function");
                this._state = null;
                this._value = null;
                this._deferreds = [];
                this._catched = !1;
                var r = this,
                    u = !0;
                this._PSD = t.PSD;
                try {
                    k(this, n, function(n) {
                        u ? i(c, r, n) : c(r, n)
                    }, function(n) {
                        return u ? (i(s, r, n), !1) : s(r, n)
                    })
                } finally {
                    u = !1
                }
            }

            function o(n, f) {
                var s, o, l, a, b, c;
                if (n._state === null) {
                    n._deferreds.push(f);
                    return
                }
                if (s = n._state ? f.onFulfilled : f.onRejected, s === null) return (n._state ? f.resolve : f.reject)(n._value);
                l = r;
                r = !1;
                i = y;
                try {
                    a = t.PSD;
                    t.PSD = n._PSD;
                    o = s(n._value);
                    n._state || o && typeof o.then == "function" && o._state === !1 || w(n);
                    f.resolve(o)
                } catch (v) {
                    if (b = f.reject(v), !b && n.onuncatched) try {
                        n.onuncatched(v)
                    } catch (v) {}
                } finally {
                    if (t.PSD = a, l) {
                        do {
                            while (u.length > 0) p();
                            if (c = e.pop(), c) try {
                                c()
                            } catch (v) {}
                        } while (e.length > 0 || u.length > 0);
                        i = h;
                        r = !0
                    }
                }
            }

            function d(n) {
                var f = r,
                    t;
                r = !1;
                i = y;
                try {
                    n()
                } finally {
                    if (f) {
                        do {
                            while (u.length > 0) p();
                            if (t = e.pop(), t) try {
                                t()
                            } catch (o) {}
                        } while (e.length > 0 || u.length > 0);
                        i = h;
                        r = !0
                    }
                }
            }

            function w(n) {
                n._catched = !0;
                n._parent && w(n._parent)
            }

            function c(n, i) {
                var r = t.PSD;
                t.PSD = n._PSD;
                try {
                    if (i === n) throw new TypeError("A promise cannot be resolved with itself.");
                    if (i && (typeof i == "object" || typeof i == "function") && typeof i.then == "function") {
                        k(n, function(n, t) {
                            i.then(n, t)
                        }, function(t) {
                            c(n, t)
                        }, function(t) {
                            s(n, t)
                        });
                        return
                    }
                    n._state = !0;
                    n._value = i;
                    b.call(n)
                } catch (u) {
                    s(u)
                } finally {
                    t.PSD = r
                }
            }

            function s(n, i) {
                var r = t.PSD;
                if (t.PSD = n._PSD, n._state = !1, n._value = i, b.call(n), !n._catched) try {
                    if (n.onuncatched) n.onuncatched(n._value);
                    t.on.error.fire(n._value)
                } catch (u) {}
                return t.PSD = r, n._catched
            }

            function b() {
                for (var n = 0, t = this._deferreds.length; n < t; n++) o(this, this._deferreds[n]);
                this._deferreds = []
            }

            function l(n, t, i, r) {
                this.onFulfilled = typeof n == "function" ? n : null;
                this.onRejected = typeof t == "function" ? t : null;
                this.resolve = i;
                this.reject = r
            }

            function k(n, t, i, r) {
                var u = !1;
                try {
                    t(function(n) {
                        u || (u = !0, i(n))
                    }, function(t) {
                        return u ? n._catched : (u = !0, r(t))
                    })
                } catch (f) {
                    return u ? void 0 : r(f)
                }
            }
            var a = [].slice,
                h = typeof setImmediate == "undefined" ? function(t) {
                    var i = arguments;
                    setTimeout(function() {
                        t.apply(n, a.call(i, 1))
                    }, 0)
                } : setImmediate,
                i = h,
                r = !0,
                u = [],
                e = [];
            return t.on = v(null, "error"), t.all = function() {
                var n = Array.prototype.slice.call(arguments.length === 1 && Array.isArray(arguments[0]) ? arguments[0] : arguments);
                return new t(function(t, i) {
                    function f(r, e) {
                        try {
                            if (e && (typeof e == "object" || typeof e == "function")) {
                                var o = e.then;
                                if (typeof o == "function") {
                                    o.call(e, function(n) {
                                        f(r, n)
                                    }, i);
                                    return
                                }
                            }
                            n[r] = e;
                            --u == 0 && t(n)
                        } catch (s) {
                            i(s)
                        }
                    }
                    var u, r;
                    if (n.length === 0) return t([]);
                    for (u = n.length, r = 0; r < n.length; r++) f(r, n[r])
                })
            }, t.prototype.then = function(n, r) {
                var f = this,
                    u = new t(function(t, u) {
                        f._state === null ? o(f, new l(n, r, t, u)) : i(o, f, new l(n, r, t, u))
                    });
                return u._PSD = this._PSD, u.onuncatched = this.onuncatched, u._parent = this, u
            }, t.prototype._then = function(n, t) {
                o(this, new l(n, t, f, f))
            }, t.prototype["catch"] = function(n) {
                if (arguments.length === 1) return this.then(null, n);
                var i = arguments[0],
                    r = arguments[1];
                return typeof i == "function" ? this.then(null, function(n) {
                    return n instanceof i ? r(n) : t.reject(n)
                }) : this.then(null, function(n) {
                    return n && n.name === i ? r(n) : t.reject(n)
                })
            }, t.prototype["finally"] = function(n) {
                return this.then(function(t) {
                    return n(), t
                }, function(i) {
                    return n(), t.reject(i)
                })
            }, t.prototype.onuncatched = null, t.resolve = function(n) {
                var i = new t(function() {});
                return i._state = !0, i._value = n, i
            }, t.reject = function(n) {
                var i = new t(function() {});
                return i._state = !1, i._value = n, i
            }, t.race = function(n) {
                return new t(function(t, i) {
                    n.map(function(n) {
                        n.then(t, i)
                    })
                })
            }, t.PSD = null, t.newPSD = function(n) {
                var i = t.PSD;
                t.PSD = i ? Object.create(i) : {};
                try {
                    return n()
                } finally {
                    t.PSD = i
                }
            }, t._rootExec = d, t._tickFinalize = function(n) {
                if (r) throw new Error("Not in a virtual tick");
                e.push(n)
            }, t
        }(),
        e = function() {},
        g;
    y(d).from(Error);
    u.delete = function(n) {
        var t = new u(n),
            i = t.delete();
        return i.onblocked = function(n) {
            t.on("blocked", n);
            return this
        }, i
    };
    u.getDatabaseNames = function(n) {
        return new r(function(n, t) {
            var r = ct(),
                i;
            r ? (i = r(), i.onsuccess = function(t) {
                n([].slice.call(t.target.result, 0))
            }, i.onerror = o(t)) : rt(function(t) {
                return n(t), !1
            })
        }).then(n)
    };
    u.defineClass = function(n) {
        function t(n) {
            n && s(this, n)
        }
        return it(t.prototype, n), t
    };
    u.ignoreTransaction = function(n) {
        return r.newPSD(function() {
            return r.PSD.trans = null, n()
        })
    };
    u.spawn = function() {
        return n.console && console.warn("Dexie.spawn() is deprecated. Use Dexie.ignoreTransaction() instead."), u.ignoreTransaction.apply(this, arguments)
    };
    u.vip = function(n) {
        return r.newPSD(function() {
            return r.PSD.letThrough = !0, n()
        })
    };
    Object.defineProperty(u, "currentTransaction", {
        get: function() {
            return r.PSD && r.PSD.trans || null
        }
    });
    u.Promise = r;
    u.derive = y;
    u.extend = s;
    u.override = p;
    u.events = v;
    u.getByKeyPath = c;
    u.setByKeyPath = h;
    u.delByKeyPath = ot;
    u.shallowClone = tt;
    u.deepClone = l;
    u.addons = [];
    u.fakeAutoComplete = e;
    u.asap = b;
    u.ModifyError = d;
    u.MultiModifyError = d;
    u.IndexSpec = a;
    u.TableSchema = ut;
    g = n.idbModules && n.idbModules.shimIndexedDB ? n.idbModules : {};
    u.dependencies = {
        indexedDB: g.shimIndexedDB || n.indexedDB || n.mozIndexedDB || n.webkitIndexedDB || n.msIndexedDB,
        IDBKeyRange: g.IDBKeyRange || n.IDBKeyRange || n.webkitIDBKeyRange,
        IDBTransaction: g.IDBTransaction || n.IDBTransaction || n.webkitIDBTransaction,
        Error: n.Error || String,
        SyntaxError: n.SyntaxError || String,
        TypeError: n.TypeError || String,
        DOMError: n.DOMError || String,
        localStorage: (typeof chrome != "undefined" && chrome !== null ? chrome.storage : void 0) != null ? null : n.localStorage
    };
    u.version = 1.1;
    t("Dexie", u);
    et(function() {
        e = et
    })
}).apply(null, typeof define == "function" && define.amd ? [self || window, function(n, t) {
    define(n, function() {
        return t
    })
}] : typeof global != "undefined" && typeof module != "undefined" && module.exports ? [global, function(n, t) {
    module.exports = t
}] : [self || window, function(n, t) {
    (self || window)[n] = t
}]);
//# sourceMappingURL=Dexie.min.js.map
